// Generated by CoffeeScript 1.6.3
(function() {
  var localVideo, peer, peerID, remoteVideo, videoStream;

  peerID = Math.random().toString(36).substr(2, 10);

  document.querySelector('#peerID').innerHTML = peerID;

  localVideo = document.querySelector('#localVideo');

  remoteVideo = document.querySelector('#remoteVideo');

  videoStream = new RTC.VideoStream(function() {
    localVideo.src = videoStream.getSource();
    return localVideo.play();
  });

  peer = new Peer(peerID, {
    key: 'xfptwovfgvi',
    debug: 3
  });

  peer.on('open', function(id) {
    Logger.trace('peer.on.open');
    return Logger.log(id);
  });

  peer.on('connection', function(conn) {
    Logger.trace('peer.on.connection');
    return Logger.log(conn);
  });

  peer.on('call', function(call) {
    Logger.trace('peer.on.call');
    Logger.log(call);
    return call.answer(videoStream.getStream());
  });

  peer.on('error', function(err) {
    return Logger.error(err.message);
  });

  document.querySelector('#connect').onclick = (function() {
    var call, connectID;
    connectID = document.querySelector('#connectID').value;
    call = peer.call(connectID, videoStream.getStream());
    Logger.log(call);
    return call.on('stream', function(stream) {
      Logger.trace('call.on.stream');
      Logger.log(stream);
      remoteVideo.src = URL.createObjectURL(stream);
      return remoteVideo.play();
    });
  });

}).call(this);
